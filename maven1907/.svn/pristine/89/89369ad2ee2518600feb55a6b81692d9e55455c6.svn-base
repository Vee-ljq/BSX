<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ry.mapper.BOrdermainMapper">
  <resultMap id="BaseResultMap" type="com.ry.pojo.BOrdermain">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    <id column="ID" jdbcType="INTEGER" property="id" />
    <result column="orderNo" jdbcType="VARCHAR" property="orderno" />
    <result column="cusId" jdbcType="INTEGER" property="cusid" />
    <result column="addressId" jdbcType="INTEGER" property="addressid" />
    <result column="totalCount" jdbcType="VARCHAR" property="totalcount" />
    <result column="createDate" jdbcType="VARCHAR" property="createdate" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="fkDate" jdbcType="VARCHAR" property="fkdate" />
    <result column="fhDate" jdbcType="VARCHAR" property="fhdate" />
    <result column="shDate" jdbcType="VARCHAR" property="shdate" />
    <result column="pjDate" jdbcType="VARCHAR" property="pjdate" />
    <result column="wxOrderNo" jdbcType="VARCHAR" property="wxorderno" />
    <result column="zfbOrderNo" jdbcType="VARCHAR" property="zfborderno" />
    <result column="wlId" jdbcType="INTEGER" property="wlid" />
    <result column="wlNo" jdbcType="VARCHAR" property="wlno" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    ID, orderNo, cusId, addressId, totalCount, createDate, status, fkDate, fhDate, shDate, 
    pjDate, wxOrderNo, zfbOrderNo, wlId, wlNo
  </sql>
  <select id="selectByExample" parameterType="com.ry.pojo.BOrdermainExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from b_ordermain
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    select 
    <include refid="Base_Column_List" />
    from b_ordermain
    where ID = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    delete from b_ordermain
    where ID = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.ry.pojo.BOrdermainExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    delete from b_ordermain
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.ry.pojo.BOrdermain">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    insert into b_ordermain (ID, orderNo, cusId, 
      addressId, totalCount, createDate, 
      status, fkDate, fhDate, 
      shDate, pjDate, wxOrderNo, 
      zfbOrderNo, wlId, wlNo
      )
    values (#{id,jdbcType=INTEGER}, #{orderno,jdbcType=VARCHAR}, #{cusid,jdbcType=INTEGER}, 
      #{addressid,jdbcType=INTEGER}, #{totalcount,jdbcType=VARCHAR}, #{createdate,jdbcType=VARCHAR}, 
      #{status,jdbcType=INTEGER}, #{fkdate,jdbcType=VARCHAR}, #{fhdate,jdbcType=VARCHAR}, 
      #{shdate,jdbcType=VARCHAR}, #{pjdate,jdbcType=VARCHAR}, #{wxorderno,jdbcType=VARCHAR}, 
      #{zfborderno,jdbcType=VARCHAR}, #{wlid,jdbcType=INTEGER}, #{wlno,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.ry.pojo.BOrdermain" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    insert into b_ordermain
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        ID,
      </if>
      <if test="orderno != null">
        orderNo,
      </if>
      <if test="cusid != null">
        cusId,
      </if>
      <if test="addressid != null">
        addressId,
      </if>
      <if test="totalcount != null">
        totalCount,
      </if>
      <if test="createdate != null">
        createDate,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="fkdate != null">
        fkDate,
      </if>
      <if test="fhdate != null">
        fhDate,
      </if>
      <if test="shdate != null">
        shDate,
      </if>
      <if test="pjdate != null">
        pjDate,
      </if>
      <if test="wxorderno != null">
        wxOrderNo,
      </if>
      <if test="zfborderno != null">
        zfbOrderNo,
      </if>
      <if test="wlid != null">
        wlId,
      </if>
      <if test="wlno != null">
        wlNo,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="orderno != null">
        #{orderno,jdbcType=VARCHAR},
      </if>
      <if test="cusid != null">
        #{cusid,jdbcType=INTEGER},
      </if>
      <if test="addressid != null">
        #{addressid,jdbcType=INTEGER},
      </if>
      <if test="totalcount != null">
        #{totalcount,jdbcType=VARCHAR},
      </if>
      <if test="createdate != null">
        #{createdate,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="fkdate != null">
        #{fkdate,jdbcType=VARCHAR},
      </if>
      <if test="fhdate != null">
        #{fhdate,jdbcType=VARCHAR},
      </if>
      <if test="shdate != null">
        #{shdate,jdbcType=VARCHAR},
      </if>
      <if test="pjdate != null">
        #{pjdate,jdbcType=VARCHAR},
      </if>
      <if test="wxorderno != null">
        #{wxorderno,jdbcType=VARCHAR},
      </if>
      <if test="zfborderno != null">
        #{zfborderno,jdbcType=VARCHAR},
      </if>
      <if test="wlid != null">
        #{wlid,jdbcType=INTEGER},
      </if>
      <if test="wlno != null">
        #{wlno,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.ry.pojo.BOrdermainExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    select count(*) from b_ordermain
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    update b_ordermain
    <set>
      <if test="record.id != null">
        ID = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.orderno != null">
        orderNo = #{record.orderno,jdbcType=VARCHAR},
      </if>
      <if test="record.cusid != null">
        cusId = #{record.cusid,jdbcType=INTEGER},
      </if>
      <if test="record.addressid != null">
        addressId = #{record.addressid,jdbcType=INTEGER},
      </if>
      <if test="record.totalcount != null">
        totalCount = #{record.totalcount,jdbcType=VARCHAR},
      </if>
      <if test="record.createdate != null">
        createDate = #{record.createdate,jdbcType=VARCHAR},
      </if>
      <if test="record.status != null">
        status = #{record.status,jdbcType=INTEGER},
      </if>
      <if test="record.fkdate != null">
        fkDate = #{record.fkdate,jdbcType=VARCHAR},
      </if>
      <if test="record.fhdate != null">
        fhDate = #{record.fhdate,jdbcType=VARCHAR},
      </if>
      <if test="record.shdate != null">
        shDate = #{record.shdate,jdbcType=VARCHAR},
      </if>
      <if test="record.pjdate != null">
        pjDate = #{record.pjdate,jdbcType=VARCHAR},
      </if>
      <if test="record.wxorderno != null">
        wxOrderNo = #{record.wxorderno,jdbcType=VARCHAR},
      </if>
      <if test="record.zfborderno != null">
        zfbOrderNo = #{record.zfborderno,jdbcType=VARCHAR},
      </if>
      <if test="record.wlid != null">
        wlId = #{record.wlid,jdbcType=INTEGER},
      </if>
      <if test="record.wlno != null">
        wlNo = #{record.wlno,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    update b_ordermain
    set ID = #{record.id,jdbcType=INTEGER},
      orderNo = #{record.orderno,jdbcType=VARCHAR},
      cusId = #{record.cusid,jdbcType=INTEGER},
      addressId = #{record.addressid,jdbcType=INTEGER},
      totalCount = #{record.totalcount,jdbcType=VARCHAR},
      createDate = #{record.createdate,jdbcType=VARCHAR},
      status = #{record.status,jdbcType=INTEGER},
      fkDate = #{record.fkdate,jdbcType=VARCHAR},
      fhDate = #{record.fhdate,jdbcType=VARCHAR},
      shDate = #{record.shdate,jdbcType=VARCHAR},
      pjDate = #{record.pjdate,jdbcType=VARCHAR},
      wxOrderNo = #{record.wxorderno,jdbcType=VARCHAR},
      zfbOrderNo = #{record.zfborderno,jdbcType=VARCHAR},
      wlId = #{record.wlid,jdbcType=INTEGER},
      wlNo = #{record.wlno,jdbcType=VARCHAR}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.ry.pojo.BOrdermain">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    update b_ordermain
    <set>
      <if test="orderno != null">
        orderNo = #{orderno,jdbcType=VARCHAR},
      </if>
      <if test="cusid != null">
        cusId = #{cusid,jdbcType=INTEGER},
      </if>
      <if test="addressid != null">
        addressId = #{addressid,jdbcType=INTEGER},
      </if>
      <if test="totalcount != null">
        totalCount = #{totalcount,jdbcType=VARCHAR},
      </if>
      <if test="createdate != null">
        createDate = #{createdate,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="fkdate != null">
        fkDate = #{fkdate,jdbcType=VARCHAR},
      </if>
      <if test="fhdate != null">
        fhDate = #{fhdate,jdbcType=VARCHAR},
      </if>
      <if test="shdate != null">
        shDate = #{shdate,jdbcType=VARCHAR},
      </if>
      <if test="pjdate != null">
        pjDate = #{pjdate,jdbcType=VARCHAR},
      </if>
      <if test="wxorderno != null">
        wxOrderNo = #{wxorderno,jdbcType=VARCHAR},
      </if>
      <if test="zfborderno != null">
        zfbOrderNo = #{zfborderno,jdbcType=VARCHAR},
      </if>
      <if test="wlid != null">
        wlId = #{wlid,jdbcType=INTEGER},
      </if>
      <if test="wlno != null">
        wlNo = #{wlno,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.ry.pojo.BOrdermain">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Dec 23 15:07:15 CST 2019.
    -->
    update b_ordermain
    set orderNo = #{orderno,jdbcType=VARCHAR},
      cusId = #{cusid,jdbcType=INTEGER},
      addressId = #{addressid,jdbcType=INTEGER},
      totalCount = #{totalcount,jdbcType=VARCHAR},
      createDate = #{createdate,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      fkDate = #{fkdate,jdbcType=VARCHAR},
      fhDate = #{fhdate,jdbcType=VARCHAR},
      shDate = #{shdate,jdbcType=VARCHAR},
      pjDate = #{pjdate,jdbcType=VARCHAR},
      wxOrderNo = #{wxorderno,jdbcType=VARCHAR},
      zfbOrderNo = #{zfborderno,jdbcType=VARCHAR},
      wlId = #{wlid,jdbcType=INTEGER},
      wlNo = #{wlno,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=INTEGER}
  </update>

  
  <!--  查询所有今日新增订单-->
  <resultMap type="com.ry.dto.OrdersDto"  id="mapToday">
  <id column="ID" property="id"></id>
  <result column="orderNo" property="orderno"/>
  <result column="createDate" property="createdate"/>
  <result column="status" property="status"/>
  <result column="totalCount" property="totalcount"/>
    <association property="cusName" javaType="string">
     <result column="nickName" property="cusName"/>
    </association>
    <association property="addre" javaType="BAddress">
    <result column="address" property="address"/>
    </association>
    <collection property="orderdetail" ofType="BOrderdetail">
    <result column="totalPrice" property="totalprice"/>
    <result column="num" property="num"/>
    <result column="goodsId" property="goodsid"/>
      <association property="goods" javaType="BGoods">
     <result column="goodsName" property="goodsname"/>
      </association>
    </collection>
    </resultMap>

  <!-- *************************************** -->
  <resultMap type="com.ry.dto.NoPayDto" id="CusIdMap">
  	<id column="id" property="id"/>
  	<result column="addressId" property="addressid"/>
  	<result column="orderNo" property="orderno"/>
  	<result column="totalCount" property="totalcount"/>
  	<result column="createDate" property="createdate"/>
  	<result column="wxOrderNo" property="wxorderno"/>
  	<result column="zfbOrderNo" property="zfborderno"/>
  	<association property="bcustomer" javaType="bcustomer">
  		<result column="cusid" property="id"/>
  		<result column="nickName" property="nickname"/>
  		<result  column="mobile" property="mobile"/>
  	</association>
  	<association property="areadata1" javaType="areadata">
  		<result column="provicename" property="cityname"/>
  		<result column="proviceid" property="codeid"/>
  	</association>
  	<association property="areadata2" javaType="areadata">
  		<result column="cityname" property="cityname"/>
  		<result column="cityid" property="codeid"/>
  	</association>
  	<association property="areadata3" javaType="areadata">
  		<result column="areaname" property="cityname"/>
  		<result column="xianid" property="codeid"/>
  	</association>
  	<association property="baddress" javaType="baddress">
  	<result column="address" property="address"/>
  	</association>

  </resultMap>

  <!--  查询出所有今日新增订单-->
  <select id="selectByPageToday" parameterType="com.ry.dto.OrdersDto" resultMap="mapToday">
SELECT a.*,b.nickName,c.totalPrice,c.num,c.goodsId,d.goodsName,e.address FROM b_ordermain  a  LEFT JOIN b_customer b on a.cusId=b.ID LEFT JOIN b_orderdetail c on a.orderNo=c.mainId LEFT JOIN b_goods  d on d.id=c.goodsId LEFT JOIN b_address e on e.ID=a.addressId<where>

 a.createDate like '%${createdate}%'
 <if test="orderno!=null and orderno!=''">
 and a.orderNo=#{orderno}
 </if>
 <if test="cusName!=null and cusName!=''">
and  b.nickName LIKE '%${cusName}%'
 </if>
 <if test="status!=null and status!=''">
 and a.status=#{status}
 
 </if>
 
 
 </where>
 order by a.orderno asc
 </select> 


 <!-- 待签收列表 -->
 	<resultMap type="com.ry.dto.OrdersDto" id="signgformap" extends="BaseResultMap">
 		<collection property="orderdetail" ofType="BOrderdetail">
 			<id column="goodsId" property="goodsid"/>
 			<association property="goods" javaType="BGoods">
 				<result column="goodsName" property="goodsname"/>
 			</association>
 			<association property="customer" javaType="BCustomer">
 				<result column="realName" property="realname"/>
 				<result column="mobile" property="mobile"/>
 			</association>
 		</collection>
 	</resultMap>
 
 	
 	<select id="selectSignforByPage" parameterType="int" resultMap="signgformap">
 		select a.ID,a.orderNo,a.cusId,a.totalCount,a.fhDate,a.zfbOrderNo,a.wlNo,a.status,b.goodsId,c.goodsName,d.realName,d.mobile from b_ordermain a 
		left join b_orderdetail b on a.ID=b.mainId 
		
		left join b_goods c on b.goodsId=c.ID 
		left join b_customer d on a.cusId=d.ID
		<where>
			and a.status=2
			<if test="orderno!=null and orderno!=''">
			 and a.orderNo=#{orderno}
			</if>
		</where>
 	</select>
 	
 <!-- 确认收货 -->	
 	<update id="updateStatusById" parameterType="int">
 		update b_ordermain set status=3 where id=#{id} 
 	</update>

  <select id="selectByCusId" parameterType="string" resultMap="CusIdMap">
	SELECT a.ID,a.orderNo,b.nickName,b.mobile,a.totalCount,a.createDate,a.wxOrderNo,a.zfbOrderNo,d.cityname as provicename,e.cityname as cityname,f.cityname as areaname,c.address FROM `b_ordermain` a left join b_customer b on a.cusId=b.ID 
	
	left join b_address c on a.addressId=c.ID 
	
	left join area_data d on c.proviceId=d.codeid 
	
	
	left join area_data e on c.cityId=e.codeid 
	
	
	left join area_data f on c.areaId=f.codeid
	<where>
	  a.status=0
	  <if test="value!=null and value!=''">
	  and (a.orderNo like '%${value}%' or b.nickName like '%${value}%') 
	  </if>
  </where>
   	order by a.ID desc
  </select>
  
  
	<!-- 未支付订单进行编辑需要通过订单的id来查询信息 -->

  <select id="selectByOrderId" parameterType="com.ry.dto.NoPayDto" resultMap="CusIdMap">
	select * from (SELECT a.ID,a.orderNo,b.ID as cusid,b.nickName,b.mobile,a.totalCount,a.createDate,a.wxOrderNo,a.zfbOrderNo,a.addressId,d.codeid as proviceid,d.cityname as provicename,e.codeid as cityid,e.cityname as cityname,f.codeid as xianid,f.cityname as areaname,c.address FROM `b_ordermain` a left join b_customer b on a.cusId=b.ID 
	
	left join b_address c on a.addressId=c.ID 
	
	left join area_data d on c.proviceId=d.codeid 
	
	
	left join area_data e on c.cityId=e.codeid 
	
	
	left join area_data f on c.areaId=f.codeid
	
	<where>
	  a.status=0
	  <if test="nickname!=null and nickname!=''">
	  and (a.orderNo like '%${bcustomer.nickname}%' or b.nickName like '%${bcustomer.nickname}%') 
	  </if>
	</where> 
	order by a.ID desc) as aa where aa.ID = #{id}
  </select>
  
  <!-- ********************************* -->
  <resultMap type="com.ry.dto.OrdersDto" id="signformap" extends="BaseResultMap">
  	<collection property="orderdetail" ofType="BOrderdetail">
  		<id column="detailId" property="id"/>
  		<result column="mainId" property="mainid"/>
  		<result column="goodsId" property="goodsid"/>
  		<result column="price" property="price"/>
  		<result column="num" property="num"/>
  		<result column="totalPrice" property="totalprice"/>
  	</collection>
  </resultMap> 
  <select id="selectByPage" resultMap="signformap">
  	select b.*,a.status from b_ordermain a left join b_orderdetail b on a.ID=b.mainId where status=2
  </select>
	
	<resultMap type="com.ry.dto.OrdersDto" id="statusMap" extends="BaseResultMap">
		<association property="orderdetail1" javaType="BOrderdetail">
		<id column="detailId" property="id"/>
  		<result column="mainId" property="mainid"/>
  		<result column="goodsId" property="goodsid"/>
  		<result column="price" property="price"/>
  		<result column="num" property="num"/>
  		<result column="totalPrice" property="totalprice"/>
		</association>
		<association property="BCustomer" javaType="BCustomer">
			<result column="realName" property="realname"/>
			<result column="mobile" property="mobile"/>
		</association>
		<association property="addre" javaType="BAddress">
			<id column="addrid" property="id"/>
			<result column="proviceId" property="proviceid"/>
			<result column="cityId" property="cityid"/>
			<result column="areaId" property="areaid"/>
		</association>
	</resultMap>
	<!--根据status查询  -->
	<select id="selectByStatus" resultMap="statusMap" parameterType="BOrdermain">
	    select a.*,b.realName,b.mobile,c.ID as detailId,c.goodsId,c.price,c.num,c.totalPrice,d.proviceId,d.cityId,d.areaId from b_ordermain a LEFT JOIN b_customer b on a.cusId=b.ID LEFT JOIN
		b_orderdetail c on a.ID=c.mainId LEFT JOIN b_address d on a.addressId=d.ID 
		where a.`status`=${status}
		<if test="orderno!=null and orderno!=''">
			and (orderNo like '%${orderno}%' or b.realName like '%${orderno}%')
		</if>
	</select>
<!--详情查询  -->
	<resultMap type="com.ry.dto.OrdersDto" id="detailMap" extends="statusMap">
	
	<association property="vie" javaType="ViewAddr">
				<result column="provenceName" property="provencename"/>
				<result column="cityname" property="cityname"/>
				<result column="xName" property="xname"/>
	</association>
	<collection property="goods" ofType="BGoods">
		<result column="goodsName" property="goodsname"/>
	</collection>
	</resultMap>
	
	<select id="selectBydetailId" resultMap="detailMap" parameterType="BOrderdetail">
		select a.*,b.realName,b.mobile,c.ID as detailId,c.goodsId,c.price,c.num,c.totalPrice,
		d.goodsName,e.ID as addrid ,e.proviceId,e.cityId,e.areaId,f.provenceName,f.cityname,f.xName from b_ordermain a LEFT JOIN b_customer b 
		on a.cusId=b.ID LEFT JOIN
		b_orderdetail c on a.ID=c.mainId LEFT JOIN b_goods d on c.goodsId=d.id LEFT JOIN b_address e on a.addressId=e.ID
		LEFT JOIN view_addr f
		on e.areaId=f.xCode
		where c.ID =${id}
	</select>


	<!-- **************前端订单管理*************** -->
	<resultMap type="com.ry.dto.OrdersDto" id="ordersManageMap" extends="BaseResultMap">	
		<collection property="orderdetail" ofType="BOrderdetail">
			<id column="detailid" property="id"/>
			<result column="goodsId" property="goodsid"/>
			<result column="price" property="price"/>
			<result column="num" property="num"/>
			<result column="totalPrice" property="totalprice"/>
			<association property="goods" javaType="BGoods">
 				<result column="goodsName" property="goodsname"/>
 				<collection property="tastetypes" ofType="STastetype">
 					<id column="tastedId" property="id"/>
 					<result column="tastedName" property="typename"/>
 				</collection>
 				<collection property="packagetypes" ofType="SPackagetype">
 					<id column="packageId" property="id"/>
 					<result column="packageName" property="typename"/>
 				</collection>
 			</association>
		</collection>
	</resultMap>
	
	<select id="selectAllOrders" parameterType="BOrdermain" resultMap="ordersManageMap">
		select b.id detailid,a.ID as mainid,a.ID,a.wlId,a.wlno,a.orderNo,a.cusId,a.totalcount,a.createDate,a.status,b.goodsId,c.goodsName,b.price,b.num,b.totalPrice,b.tastedId,d.typeName as tastedName,b.packageId,e.typeName as packageName from b_ordermain a 
		left join b_orderdetail b on a.id=b.mainId
		left join b_goods c on b.goodsId=c.id
		left join s_tastetype d on b.tastedId=d.id
		left join s_packagetype e on b.packageId=e.id
		<where>
			and a.cusId=#{cusid}
			<if test="status==null">
				and a.status in(-1,0,1,2,3)
			</if>
			<if test="id!=null">
				and a.ID=#{id}
			</if>
			<if test="status!=null">
				and a.status=#{status}
			</if>
		</where>		 		
		order by status asc		
	</select>
	
	<resultMap type="com.ry.dto.BillDto" id="billmap" extends="BaseResultMap">
		<association property="BGoods" javaType="BGoods">
			<result column="goodsName" property="goodsname"/>
			<result column="price" property="price"/>
			<result column="indexImg" property="indeximg"/>
		</association>
		<collection property="BOrderdetail" ofType="BOrderdetail">
			<result column="goodsId" property="goodsid"/>
			<result column="mainId" property="mainid"/>
		</collection>
	
	</resultMap>
	<!--查询消费记录  -->
	<select id="selectAllGoods" resultMap="billmap" parameterType="int">
	select a.createDate,b.goodsId,b.mainId,c.indexImg,c.goodsName,c.price from b_ordermain a 
	LEFT JOIN b_orderdetail b on a.ID =b.mainId 
	LEFT JOIN b_goods c on b.goodsId=c.id where a.`status`>=1 and a.cusId=${value}
	</select>

<resultMap type="com.ry.dto.BillDto" id="billmap2">
	<result column="sum" property="sum"/>
</resultMap>
<!--查询总消费额  -->
	<select id="selectSum" parameterType="int" resultMap="billmap2">
	select SUM(a.totalCount) as sum from b_ordermain a LEFT JOIN b_orderdetail b on a.ID =b.mainId where a.`status`>=1 and a.cusId=${value}
	</select>
	<!-- 查询收货地址 -->
	<resultMap type="com.ry.dto.OrdersDto" id="addressMap" extends="BaseResultMap">
		<association property="addre" javaType="BAddress">
			<id column="addressId" property="id"/>
			<result column="realName" property="realname"/>
			<result column="provenceid" property="proviceid"/>
			<result column="cityid" property="cityid"/>
			<result column="xCode" property="areaid"/>
			<result column="address" property="address"/>
			<result column="phone" property="phone"/>
		</association>
		<association property="vie" javaType="ViewAddr">
			<result column="provenceid" property="provenceid"/>
			<result column="provenceName" property="provencename"/>
			<result column="cityid" property="cityid"/>
			<result column="cityName" property="cityname"/>
			<result column="xCode" property="xcode"/>
			<result column="xName" property="xname"/>
		</association>
	</resultMap>
	<select id="selectAddress" parameterType="int" resultMap="addressMap">
		select a.ID,a.cusId,a.addressId,b.realName,c.*,b.address,b.phone from b_ordermain a
		left join b_address b on a.addressId=b.ID
		left join view_addr c on b.proviceId=c.provenceid
		where a.ID=#{orderid} and b.proviceId=c.provenceid and b.cityId=c.cityid and b.areaId=c.xCode
	</select>


<!--  获得最大的主表id-->	
	<select id="selectMaxId" resultType="int">
	SELECT max(ID) FROM `b_ordermain`
	</select>

	 <!-- 查询待评价订单信息 -->
	<!--<select id="selectAllWaitComment" resultMap="selectAllWaitCommentMap">
	select a.ID,a.mainId,a.goodsId,a.price,a.totalPrice,a.packageId,a.tastedId,b.`status`,c.goodsName,c.indexImg,d.typeName as tastename,e.typeName as packagename from b_orderdetail a left join b_ordermain b on a.mainId=b.ID 
LEFT join b_goods c on
a.goodsId=c.id left join s_tastetype d
ON a.tastedId=d.id LEFT JOIN s_packagetype e
ON a.packageId=e.id
where b.`status`=3
	</select>
<resultMap type="com.ry.dto.OrderDto" id="selectAllWaitCommentMap" extends="BaseResultMap">

		<collection property="orderdetail" ofType="BOrderdetail">
		<id column="detailId" property="id"/>
  		<result column="mainId" property="mainid"/>
  		<result column="goodsId" property="goodsid"/>
  		<result column="price" property="price"/>
  		<result column="num" property="num"/>
  		<result column="totalPrice" property="totalprice"/>
		<collection property=" "></collection>
		
		</collection>

</resultMap> -->

	<select id="selectGoodsByDate" resultMap="billmap" parameterType="map">
	
		select a.createDate,b.goodsId,b.mainId,c.indexImg,c.goodsName,c.price from b_ordermain a 
		LEFT JOIN b_orderdetail b on a.ID =b.mainId 
		LEFT JOIN b_goods c on b.goodsId=c.id where a.`status`>=1 and a.cusId=${cusid} and  
		DATE_SUB(CURDATE(), INTERVAL ${date} DAY) &lt;= date(a.createDate) 
	</select>


	<resultMap type="com.ry.dto.OrdersDto" id="rjConsumptionMap" extends="BaseResultMap">	
		<collection property="orderdetail" ofType="BOrderdetail">
			<id column="detailid" property="id"/>
			<result column="totalPrice" property="totalprice"/>
			<association property="goods" javaType="BGoods">			
 				<association property="goodstype" javaType="SGoodstype">
 					<id column="id" property="id"/>
 					<result column="pid" property="pid"/>
 					<result column="typename" property="typename"/>

 					<result column="totalmoney" property="salesmoney"/>
 					

 					<result column="rj" property="rj"/>

 					
 				</association>
 			</association>
		</collection>
	</resultMap>
	<!-- 人均消费统计分析 -->
	<select id="rjConsumption" resultMap="rjConsumptionMap">
		select a.typename,FORMAT(sum(d.totalprice)/count(distinct e.cusid) ,2) rj from s_goodstype a 
		 left join s_goodstype b on a.id=b.pid 
		 left join b_goods c on c.typeId= b.id 
		 left join b_orderdetail d on d.goodsId=c.id 
		 left join b_ordermain e on e.id=d.mainid 
		 where a.pid=0 and a.status=1 GROUP BY a.id
	</select>


	<!-- 销售金额分析  -->
	<select id="salesmoney" resultMap="rjConsumptionMap">
	select a.typeName,sum(d.totalPrice) as totalmoney from s_goodstype a 
	left join s_goodstype b 
	on b.pid = a.id 
	LEFT JOIN b_goods c 
	ON b.id=c.typeId 
	LEFT JOIN b_orderdetail d 
	ON c.id=d.goodsId 
	where a.pid=0 and a.`status`=1 GROUP BY a.id
	</select>


	
	<!--  //更新主表的totalcount -->
	<update id="updateMainTotalPriById" parameterType="int">
UPDATE b_ordermain set totalCount=(SELECT sum(totalPrice) FROM b_orderdetail WHERE mainId=#{mainid}) WHERE ID=#{mainid}	
	</update>

	<select id="noEvaluationCount" resultType="int">
		select count(*) from b_ordermain where status=3
	</select>

<!--查询今日销售额  -->
    <select id="selecttodaymoney" resultType="string">
    select sum(b.totalPrice) as todaytotal from b_ordermain a 
    left join b_orderdetail b 
    on a.id = b.mainId 
    WHERE DATE_SUB(CURDATE(), INTERVAL 0 DAY) &lt;= a.createDate AND a.`status`>2
    </select>
    <!--  <resultMap type="com.ry.dto.OrdersDto" id="todaymoneyMap">
    <id column="ID" property="id"/>
    <result column="createDate" property="createdate"/>
    <result column="status" property="status"/>
    <collection property="orderdetail" ofType="BOrderdetail">
    <result column="totalPrice" property="totalprice"/>
    
    
    </collection>
    
    
    </resultMap> -->

</mapper>